<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>Weak Links | Simon Hearne</title>

	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/awesome.css">
	<link rel="stylesheet" href="css/custom.css">

	<!-- Theme used for syntax highlighting of code -->
	<link rel="stylesheet" href="lib/css/zenburn.css">

	<!-- Printing and PDF exports -->
	<script>
		var link = document.createElement('link');
		link.rel = 'stylesheet';
		link.type = 'text/css';
		link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
		document.getElementsByTagName('head')[0].appendChild(link);
	</script>
	<script src="lib/js/d3.v4.min.js"></script>
</head>
<!-- TODO
re-make andy's chart with RUM data
compare http archive performance with crux
integrate thirdparty db into thirdparty impact
create third-party insights?
sort out this repo... talks/weaklinks?
add request map to impact

-->

<body>
	<div class="reveal">
		<div class="slides">
			<section data-state="title-slide">
				<h1>Third-Party Content</h1>
				<h2>The weak link in your chain?</h2>
				<p class="subtitle smaller">Simon Hearne - Principle Engineer @ Akamai</p>
				<p class="subtitle bottom-left">#perfmatters conf 2018</p>
			</section>
			<!--
			<section data-state="main-slide">
				<h2>Other metaphors...</h2>
				<div class="center-container-1">
					<div class="center-container-2">
						<div class="centered align-left">
							<p class="fragment">ğŸ‘¶ Parasites</p>
							<p style="opacity:0;">ğŸ“‰ Those stocks...</p>
							<p style="opacity:0;">ğŸ¤¡ That person at all the parties...</p>
						</div>
					</div>
				</div>
			</section>
			<section data-state="main-slide">
				<h2>Other metaphors...</h2>
				<div class="center-container-1">
					<div class="center-container-2">
						<div class="centered align-left">
							<p>ğŸ¦‡ Parasites</p>
							<p class="fragment">ğŸ“‰ Those stocks...</p>
							<p class="fragment">ğŸ¤¡ That person at all the parties...</p>
						</div>
					</div>
				</div>
			</section>
		-->
			<section data-state="main-slide">
				<h4>AKA</h4>
				<h2>Bad people<br>doing horrible things<br>to good sites</h2>
			</section>
			<section data-state="main-slide">
				<!-- TODO: the chain? write code, test, deploy to staging, deploy to live, third-parties...-->
				<h2>The modern web workflow 101</h2>
				<div class="center-container-1">
					<div class="center-container-2">
						<div class="centered align-right">
							<p class="fragment">make something ğŸ¤“</p>
							<p class="fragment"> test it ğŸ‘</p>
							<p class="fragment"> ship it ğŸ˜</p>
							<p class="fragment">...&nbsp;</p>
							<p class="fragment">put tags on it ğŸ˜³</p>
						</div>
					</div>
				</div>
			</section>
			<section data-state="main-slide" data-background-image="images/waterfall-canonical-vs-amp.png" data-background-size="contain">
				<h2>AMP got something right ğŸ™„</h2>
				<p class="subtitle bottom-left smaller text-shadow">
					<a href="https://timkadlec.com/remembers/2018-03-19-how-fast-is-amp-really/">timkadlec.com/remembers/2018-03-19-how-fast-is-amp-really/</a>
				</p>
			</section>
			<section data-state="main-slide">
				<h2>What i've learned in 5 years</h2>
				<p class="fragment">we
					<em>seem</em> to have less control than ever</p>
			</section>
			<section>
				<section data-state="secondary-slide">
					<h2>The "business" ğŸ‘©â€âœˆï¸</h2>
				</section>
				<section data-state="tertiary-slide">
					<h3>Tags serve business goals</h3>
					<ul>
						<li class="fragment">Measurement &amp; Analytics</li>
						<li class="fragment">Ads &amp; Retargeting</li>
						<li class="fragment">"Optimization" &amp; Testing</li>
						<li class="fragment">Comments &amp; Live Chat</li>
						<li class="fragment">Tag Management</li>
					</ul>
				</section>
				<section data-state="tertiary-slide">
					<h3>The
						<em>money</em> &nbsp;ğŸ’µ
					</h3>
					<blockquote>â€œWe know that Optimizely slows down the site, but it will get us $750k increased revenue this yearâ€</blockquote>
					<p class="subtitle bottom-left smallest">Holiday website, UK</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>The
						<em>it's not my job</em> &nbsp;ğŸ¤·â€
					</h3>
					<blockquote>â€œWe suspect it slows the site down, we havenâ€™t tested it. Marketing says itâ€™s critical to their latest TV campaign so
						thereâ€™s no point arguingâ€</blockquote>
					<p class="subtitle bottom-left smallest">Budget airline, UK</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>The
						<em>tag manager</em> &nbsp;ğŸ•´
					</h3>
					<blockquote>â€œAll the tags go through the tag manager, so they should be fine.â€</blockquote>
					<p class="subtitle bottom-left smallest">Clicks-and-mortar store, UK</p>
				</section>
			</section>
			<section>
				<section data-state="main-slide">
					<h4>but what about the</h4>
					<h1>Risk?</h1>
					<h2 class="spinning">ğŸ²</h2>
				</section>
				<section data-state="tertiary-slide">
					<h3>Availability Heuristic 101 ğŸ¤”</h3>
					<img src="images/availability-bias.jpg"></img>
				</section>
				<section data-state="tertiary-slide">
					<h3>Availability Heuristic 101 ğŸ¤”</h3>
					<ul class="no-bullets">
						<li>Remember when Facebook went down?</li>
						<li class="fragment">Remember when Disqus went down?</li>
						<li class="fragment">Remember when Maxymiser went down?</li>
						<li class="fragment">Remember when
							<b>Dyn</b> went down?</li>
				</section>
			</section>
			<section>
				<section data-state="secondary-slide">
					<h4>Risk 1:</h4>
					<h2>Malicious code injection ğŸ‘¹</h2>
				</section>
				<section data-state="tertiary-slide">
					<h3>CryptoJacking</h3>
					<img src="images/cryptojacking.png" />
					<p class="subtitle bottom-left smallest">
						<a href="https://www.theverge.com/2018/3/22/17147320/cryptojacking-8500-percentage-points-bitcoin-monero-spike-symantec-security-mining">www.theverge.com/2018/3/22/17147320/cryptojacking-8500-percentage-points-bitcoin-monero-spike-symantec-security-mining</a>
					</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>It happens to the biggest players</h3>
					<img src="images/nytimes.png" />
					<p class="subtitle bottom-left smallest">
						<a href="https://twitter.com/nytimes/status/3958547840">twitter.com/nytimes/status/3958547840</a>
					</p>
				</section>
				<!--
				<section data-state="tertiary-slide">
					<h3>P*ssed employees ğŸ’©</h3>
				</section>
				<section data-state="tertiary-slide">
					</h3>l33t h4x0r5 ğŸ‘©â€ğŸ’»</h3>
				</section>
			-->
				<section data-state="tertiary-slide">
					<h3>Internet 'Service' Providers </h3>
					<img src="images/comcast.png" />
					<p class="subtitle bottom-left smallest">
						<a href="https://blog.ryankearney.com/2013/01/comcast-caught-intercepting-and-altering-your-web-traffic/">blog.ryankearney.com/2013/01/comcast-caught-intercepting-and-altering-your-web-traffic/</a>
					</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Content Delivery Networks</h3>
					<img src="images/amp_cdn.png" />
					<p class="subtitle bottom-left smallest">
						<a href="https://github.com/ampproject/amphtml/issues/2380">github.com/ampproject/amphtml/issues/2380</a>
					</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Unintentional data collection</h3>
					<blockquote>website tracking is a "security disaster waiting to happen"</blockquote>
					<iframe width="560" height="315" data-src="https://www.youtube.com/embed/GJWzNm_dTwc?rel=0&amp;controls=0&amp;showinfo=0&amp;autoplay=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
					<p class="subtitle bottom-left smallest">
							<a href="https://freedom-to-tinker.com/2018/02/26/no-boundaries-for-credentials-password-leaks-to-mixpanel-and-session-replay-companies/">freedom-to-tinker.com/2018/02/26/no-boundaries-for-credentials-password-leaks-to-mixpanel-and-session-replay-companies/</a>
						</p>
				</section>
			</section>
			<section>
				<section data-state="secondary-slide">
					<h4>Risk 2:</h4>
					<h2>Availability ğŸ“‰</h2>
				</section>
				<section data-state="tertiary-slide">
					<h3>Do they fail gracefully?</h3>
					<video controls="no" autoplay="true" loop="true" name="Trumpy Tweety" src="videos/trump_tweet.mov"></video>
					<p>ğŸ‘</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Do they fail gracefully?</h3>
					<p class="todo">TODO: SPoF</p>
					<p>ğŸ‘</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Are they using a CDN?</h3>
					<p class="fragment">Is it as good as yours?</p>
					<p class="todo">TODO: e.g. optimix.asia on akamai</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>What is their SLA for availability?</h3>
					<p class="fragment">Is it as good as yours?</p>
					<p class="todo">TODO: are there any public slas?</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Availability to the user</h3>
					<p class="fragment">Government / geo blocking</p>
					<p class="fragment">Ad blocking</p>
					<p class="fragment">Tracker blocking</p>
					<p class="fragment">Random crap</p>
				</section>
			</section>
			<section>
				<section data-state="secondary-slide">
					<h4>Risk 3:</h4>
					<h2>Code Quality ğŸ”</h2>
				</section>
				<section data-state="tertiary-slide">
					<h3>XSS Vulnerabilites</h3>
					<img src="images/telegraph-xss.png" />
					<p class="subtitle bottom-left smallest">
						<a href="https://randywestergren.com/widespread-xss-vulnerabilities-ad-network-code-affecting-top-tier-publishers-retailers/">randywestergren.com/widespread-xss-vulnerabilities-ad-network-code-affecting-top-tier-publishers-retailers/</a>
					</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>XSS Vulnerabilites</h3>
					<pre><code class="hljs" style="font-size:80%;">
document.write("&lt;div
	class='vdb_player vdb_565ec775e4b092ebc9685ce853180f5de4b066208a63279a'
	vdb_params='m.pub_id=606413&m.url=http://nypost.com/#1' - alert(1) - '-alert(1)-'&gt;
	&lt;/div&gt;");
					</code></pre>
					<p class="subtitle bottom-left smallest">
						<a href="https://randywestergren.com/widespread-xss-vulnerabilities-ad-network-code-affecting-top-tier-publishers-retailers/">randywestergren.com/widespread-xss-vulnerabilities-ad-network-code-affecting-top-tier-publishers-retailers/</a>
					</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Different release schedules</h3>
					<pre><code class="hlhtml">
&lt;script src="//s7.addthis.com/addthis_widget.js" async&gt;&lt;/script&gt;
					</code></pre>
					<!--<img style="filter:invert(1);" width="100px" class="naked" src="images/curved-arrow.svg"/>-->
					<h4>How do you know when it changes? </h4>
					<p class="subtitle bottom-left smallest">
						<a href="https://www.addthis.com">www.addthis.com</a>
					</p>
				</section>
				<!--
				<section data-state="tertiary-slide">
					<p>Polluting the global scope</p>
				</section>
				<section data-state="tertiary-slide">
					<p>Clearing the console log</p>
				</section>
			-->
				<section data-state="tertiary-slide">
					<h3>Just plain thoughtless</h3>
					<img src="images/newrelic.png" />
					<p class="subtitle bottom-left smallest">
						<a href="https://discuss.newrelic.com/t/do-not-clear-the-resource-timing-buffer/54771">discuss.newrelic.com/t/do-not-clear-the-resource-timing-buffer/</a>
					</p>
				</section>
			</section>
			<section>
				<section data-state="secondary-slide">
					<h4>Risk 4:</h4>
					<h2>Performance ğŸš€</h2>
				</section>
				<section data-state="tertiary-slide">
					<h3>Self-policing isn't good enough</h3>
					<blockquote>
						... the X Web Reference Snippet was available ... and the download time over
						<b>HTTP</b> did not exceed
						<b>500 ms</b>.
					</blockquote>
					<blockquote class="fragment">
						Snippet is sampled every minute from a variety of
						<b>U.S.</b> locations.
					</blockquote>
					<p class="subtitle bottom-left smallest">status.optimizely.com</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Tools aren't equal</h3>
					<img width="60%" src="images/ab_tools.png"/>
					<p class="subtitle bottom-left smallest"><a href="https://orangevalley.nl/en/blog/9-ab-testing-tools-compared-on-site-speed-impact/">orangevalley.nl/en/blog/9-ab-testing-tools-compared-on-site-speed-impact/</a></p>
				</section>
				<section data-state="tertiary-slide">
					<h3>The web is variable</h3>
					<div style="width:900px;height:400px;" id="svg-container-1"></div>
					<script>
						var width = 900;
						var height = 400;
						var barWidth = 30;
					  
						var margin = {top: 20, right: 10, bottom: 20, left: 10};
					  
						var width = width - margin.left - margin.right,
							height = height - margin.top - margin.bottom;
					  
						var totalWidth = width + margin.left + margin.right;
						var totalheight = height + margin.top + margin.bottom;
					  
						// Generate five 100 count, normal distributions with random means
						var groupCounts = {};
						var globalCounts = [];
						var meanGenerator = d3.randomUniform(10);
						for(i=0; i<7; i++) {
						  var randomMean = meanGenerator();
						  var generator = d3.randomNormal(randomMean);
						  var key = i.toString();
						  groupCounts[key] = [];
					  
						  for(j=0; j<100; j++) {
							var entry = generator();
							groupCounts[key].push(entry);
							globalCounts.push(entry);
						  }
						}
					  
						// Sort group counts so quantile methods work
						for(var key in groupCounts) {
						  var groupCount = groupCounts[key];
						  groupCounts[key] = groupCount.sort(sortNumber);
						}
					  
						// Setup a color scale for filling each box
						var colorScale = d3.scaleOrdinal(d3.schemeCategory20)
						  .domain(Object.keys(groupCounts));
					  
						// Prepare the data for the box plots
						var boxPlotData = [];
						for (var [key, groupCount] of Object.entries(groupCounts)) {
					  
						  var record = {};
						  var localMin = d3.min(groupCount);
						  var localMax = d3.max(groupCount);
					  
						  record["key"] = key;
						  record["counts"] = groupCount;
						  record["quartile"] = boxQuartiles(groupCount);
						  record["whiskers"] = [localMin, localMax];
						  record["color"] = colorScale(key);
					  
						  boxPlotData.push(record);
						}
						console.log(boxPlotData);
					  
						// Compute an ordinal xScale for the keys in boxPlotData
						var xScale = d3.scalePoint()
						  .domain(Object.keys(groupCounts))
						  .rangeRound([0, width])
						  .padding([0.5]);
					  
						// Compute a global y scale based on the global counts
						var min = d3.min(globalCounts);
						var max = d3.max(globalCounts);
						var yScale = d3.scaleLinear()
						  .domain([min, max])
						  .range([0, height]);
					  
						// Setup the svg and group we will draw the box plot in
						var svg = d3.select("#svg-container-1").append("svg")
						  .attr("width", totalWidth)
						  .attr("height", totalheight)
						  .append("g")
						  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
					  
						// Move the left axis over 25 pixels, and the top axis over 35 pixels
						var axisG = svg.append("g").attr("transform", "translate(25,0)");
						var axisTopG = svg.append("g").attr("transform", "translate(35,0)");
					  
						// Setup the group the box plot elements will render in
						var g = svg.append("g")
						  .attr("transform", "translate(20,5)");
					  
						// Draw the box plot vertical lines
						var verticalLines = g.selectAll(".verticalLines")
						  .data(boxPlotData)
						  .enter()
						  .append("line")
						  .attr("x1", function(datum) {
							  return xScale(datum.key) + barWidth/2;
							}
						  )
						  .attr("y1", function(datum) {
							  var whisker = datum.whiskers[0];
							  return yScale(whisker);
							}
						  )
						  .attr("x2", function(datum) {
							  return xScale(datum.key) + barWidth/2;
							}
						  )
						  .attr("y2", function(datum) {
							  var whisker = datum.whiskers[1];
							  return yScale(whisker);
							}
						  )
						  .attr("stroke", "#000")
						  .attr("stroke-width", 1)
						  .attr("fill", "none");
					  
						// Draw the boxes of the box plot, filled in white and on top of vertical lines
						var rects = g.selectAll("rect")
						  .data(boxPlotData)
						  .enter()
						  .append("rect")
						  .attr("width", barWidth)
						  .attr("height", function(datum) {
							  var quartiles = datum.quartile;
							  var height = yScale(quartiles[2]) - yScale(quartiles[0]);
							  return height;
							}
						  )
						  .attr("x", function(datum) {
							  return xScale(datum.key);
							}
						  )
						  .attr("y", function(datum) {
							  return yScale(datum.quartile[0]);
							}
						  )
						  .attr("fill", function(datum) {
							return datum.color;
							}
						  )
						  .attr("stroke", "#000")
						  .attr("stroke-width", 1);
					  
						// Now render all the horizontal lines at once - the whiskers and the median
						var horizontalLineConfigs = [
						  // Top whisker
						  {
							x1: function(datum) { return xScale(datum.key) },
							y1: function(datum) { return yScale(datum.whiskers[0]) },
							x2: function(datum) { return xScale(datum.key) + barWidth },
							y2: function(datum) { return yScale(datum.whiskers[0]) }
						  },
						  // Median line
						  {
							x1: function(datum) { return xScale(datum.key) },
							y1: function(datum) { return yScale(datum.quartile[1]) },
							x2: function(datum) { return xScale(datum.key) + barWidth },
							y2: function(datum) { return yScale(datum.quartile[1]) }
						  },
						  // Bottom whisker
						  {
							x1: function(datum) { return xScale(datum.key) },
							y1: function(datum) { return yScale(datum.whiskers[1]) },
							x2: function(datum) { return xScale(datum.key) + barWidth },
							y2: function(datum) { return yScale(datum.whiskers[1]) }
						  }
						];
					  
						for(var i=0; i < horizontalLineConfigs.length; i++) {
						  var lineConfig = horizontalLineConfigs[i];
					  
						  // Draw the whiskers at the min for this series
						  var horizontalLine = g.selectAll(".whiskers")
							.data(boxPlotData)
							.enter()
							.append("line")
							.attr("x1", lineConfig.x1)
							.attr("y1", lineConfig.y1)
							.attr("x2", lineConfig.x2)
							.attr("y2", lineConfig.y2)
							.attr("stroke", "#000")
							.attr("stroke-width", 1)
							.attr("fill", "none");
						}
					  
						// Setup a scale on the left
						var axisLeft = d3.axisLeft(yScale);
						axisG.append("g")
						  .call(axisLeft);
					  
						// Setup a series axis on the top
						var axisTop = d3.axisTop(xScale);
						axisTopG.append("g")
						  .call(axisTop);
					  
						  function boxQuartiles(d) {
							return [
							  d3.quantile(d, .25),
							  d3.quantile(d, .5),
							  d3.quantile(d, .75)
							];
						  }
						  
						// Perform a numeric sort on an array
						function sortNumber(a,b) {
						  return a - b;
						}
					  
						</script>
					<p class="todo">TODO: distributions from HTTP archive?</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>The web is variable</h3>
					<h4>(and so are third-parties</h4>
					<p class="todo">TODO: Analysis from lambda_rt here</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Resource Timing to the rescue!</h3>
					<img src="images/resource-timing-overview-1.png">
					<p class="subtitle bottom-left smaller">https://www.w3.org/TR/resource-timing-1/</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Resource Timing to the rescue?</h3>
					<img src="images/resource-timing-overview-2.png">
					<p>not without Timing-Allow-Origin ğŸ™ˆ</p>
					<p class="subtitle bottom-left smaller">https://www.w3.org/TR/resource-timing-1/</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Resource Timing won't save us</h3>
					<div class="center-container-1">
						<div class="center-container-2">
							<div class="centered align-left">
								<p class="fragment">ğŸ™ˆ no redirect information</p>
								<p class="fragment">ğŸ™ˆ limited data on
									<b>72%</b> of third-party content</p>
								<p class="fragment">ğŸ™ˆ only the first 150 requests *</p>
								<p class="fragment">ğŸ™ˆ no data on old iDevices</p>
							</div>
						</div>
					</div>
					<p class="subtitle bottom-left smaller">
						<a href="https://developer.akamai.com/blog/2017/07/26/measuring-performance-third-party-contributors/">developer.akamai.com/blog/2017/07/26/measuring-performance-third-party-contributors/</a>
						<br>* can be increased and cleared
					</p>
				</section>
			</section>
			<section>
				<section data-state="secondary-slide">
					<h4>Risk 4:</h4>
					<h2>Performance ğŸš€</h2>
					<h3>(for real this time)</h3>
				</section>
				<section data-state="tertiary-slide">
					<h3>CPU is our biggest bottleneck â³</h3>
				</section>
				<section data-state="tertiary-slide"n>
					<h3>Who's policing the third-parties?</h3>
					<p class="todo">TODO: CPU abuser</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Variable CPU time</h3>
					<h4>on synthetic agents!</h4>
					<img src="images/third-party-cpu-httparchive.jpg" />
				</section>
				<section data-state="tertiary-slide">
					<h3>The most frustrating perf bug, ever</h3>
					<img src="images/onunload.png"/>
				</section>
				<section data-state="tertiary-slide">
					<h3>Who watches the watchmen?</h3>
					<p class="todo">TODO: Boomerang perf analysis</p>
				</section>
			</section>
			<section>
				<section data-state="secondary-slide">
					<h4>Risk 4:</h4>
					<h2>Performance ğŸš€</h2>
					<h3>(part III)</h3>
				</section>
				<section data-state="tertiary-slide">
					<h3>delaying onload</h3>
					<p class="todo">TODO: replay optimix.asia example?</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>DNS isn't free</h3>
					<!-- TODO: Boomerang perf analysis -->
				</section>
				<section data-state="tertiary-slide">
					<h3>keeping the radio awake</h3>
					<img src="images/clicktale.png"/>
				</section>
			</section>
			<section data-state="main-slide">
				<h2>We have little control over which are used</h2>
				<p>But there are things we can do...</p>
			</section>
			<section>
				<section data-state="secondary-slide">
					<h4>Stage 1:</h4>
					<h2>Find out what's there</h2>
					<img src="images/adblock.png"/>
					<p class="subtitle bottom-left smaller">
						<a href="http://fortune.com/2015/07/08/adblock-data/">fortune.com/2015/07/08/adblock-data/</a>
					</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Synthetic Testing (webpagetest)</h3>
					<img src="images/content-breakdown.png" />
					<p class="subtitle bottom-left smaller">
						<a href="https://www.webpagetest.org/result/180326_QK_333a4d124f5dde54debc4996177e34f4/1/domains/">webpagetest.org/</a>
					</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Synthetic Testing (webpagetest)</h3>
					<video src="videos/fjson.mov" />
					<p class="subtitle bottom-left smaller">
						<a href="https://www.webpagetest.org/result/180326_QK_333a4d124f5dde54debc4996177e34f4/1/domains/">webpagetest.org/</a>
					</p>
				</section>
				<section data-state="tertiary-slide">
					<h3 class="light-background">Request Maps</h3>
					<video src="videos/requestmap.mov"/>
					<p class="subtitle bottom-left smaller">
						<a href="https://github.com/simonhearne/requestmap/">github.com/simonhearne/requestmap/</a> |
						<a href="https://requestmap.webperf.tools/">requestmap.webperf.tools</a>
					</p>
				</section>
				<section data-background-iframe="http://requestmap.herokuapp.com/render/180326_QK_333a4d124f5dde54debc4996177e34f4/?minimalist=1&dark=1&group=thirdparty.category&legend=0"
				    data-background-interactive>
					<!--<section data-background-iframe="http://requestmap.webperf.tools/headless.php?id=180326_QK_333a4d124f5dde54debc4996177e34f4" data-background-interactive>-->
					<h3 class="light-background">Request Maps</h3>
					<p class="subtitle bottom-left smaller">
						<a href="https://github.com/simonhearne/requestmap/">github.com/simonhearne/requestmap/</a> |
						<a href="https://requestmap.webperf.tools/">requestmap.webperf.tools</a>
					</p>
				</section>
				<section data-state="tertiary-slide">
					<!--<p>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;<br></p>-->
					<h3>Bonus: Third-party categorization</h3>
					<iframe class="iframe-big" data-src="http://thirdpartydb.appspot.com/"></iframe>
					<p class="subtitle bottom-left smaller">
						<a href="https://github.com/simonhearne/thirdpartydb/">github.com/simonhearne/thirdpartydb</a> |
						<a href="https://thirdpartydb.appspot.com/">thirdpartydb.appspot.com</a>
					</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Real User Monitoring 1 ğŸ¥ƒ</h3>
					<video controls="no" autoplay="true" loop="true" name="Circle Packing" src="videos/circlepacking.mov"></video>
					<p class="subtitle bottom-left smaller">Akamai mPulse</p>
				</section>
			</section>
			<section data-state="secondary-slide">
				<section data-state="secondary-slide">
					<h4>Stage 2:</h4>
					<h2>Determine the impact</h2>
				</section>
				<section data-state="tertiary-slide">
					<h3>Synthetic Testing (webpagetest)</h3>
					<img src="images/wpt_block.png" />
				</section>
				<section data-state="tertiary-slide">
					<h3>Synthetic Testing (made easy)</h3>
					<iframe scrolling="no" class="iframe-big" data-src="http://third-party-impact.herokuapp.com/domains/?test=180326_MN_72416b0fd72805f56d47e094bdcd188a"></iframe>
					<p class="subtitle bottom-left smaller">
						<a href="https://github.com/simonhearne/third-party-impact/">github.com/simonhearne/third-party-impact/</a>
					</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Synthetic Testing (made easy)</h3>
					<iframe scrolling="no" class="iframe-big" data-src="http://third-party-impact.herokuapp.com/result/?test=180326_MN_72416b0fd72805f56d47e094bdcd188a"></iframe>
					<p class="subtitle bottom-left smaller">
						<a href="https://github.com/simonhearne/third-party-impact/">github.com/simonhearne/third-party-impact/</a>
					</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Resource Impact from Synthetics ğŸ¤–</h3>
					<img src="images/catchpoint.png" />
					<p class="subtitle bottom-left smaller">#datavis brought to you by Catchpoint!</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Resource Impact from RUM</h3>
					<video controls="no" name="Resource Impact Infographic" src="videos/infographic.mov"></video>
				</section>
				<section data-state="tertiary-slide">
					<h3>Advertising Partners</h3>
					<p class="fragment">Partner 1 =
						<b>~400ms slower</b> than partner 2</p>
					<p class="fragment">Migrating all ads =
						<b>220ms faster</b> page load</p>
					<p class="fragment">Additional revenue ~=
						<b>$12,000 per month</b>
					</p>
					<p class="subtitle bottom-left smaller">Large US publishing company</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Analytics</h3>
					<p class="todo">TODO: add RIS results for analytics</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Multivariate Testing / 'Optimization'</h3>
					<p class="todo">TODO: add RIS results for optimizely</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>LongTasks API</h3>
					<p class="todo">TODO: long tasks info</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Bonus: determine the value!</h3>
					<img src="images/optimizely-test.png" />
					<p class="subtitle bottom-left smaller">
						<a href="http://blog.sumall.com/journal/optimizely-got-me-fired.html">blog.sumall.com/journal/optimizely-got-me-fired.html</a>
					</p>
				</section>
				<section data-state="tertiary-slide">
					<blockquote class="big">"Everything should have a
						<b>value</b>,
						<br>because everything has a
						<b>cost</b>"</blockquote>
					<p class="subtitle bottom-left">Tim Kadlec - freelance #webperf god</p>
				</section>
			</section>
			<section data-state="secondary-slide">
				<section data-state="secondary-slide">
					<h4>Stage 3:</h4>
					<h2>Measure them and Report on them</h2>
				</section>
				<section data-state="tertiary-slide">
					<h3>Content Security Policy ğŸ‘®â€</h3>
					<h4>(report-only)</h4>
					<p>Browsers have done the hard work for us!</p>
					<p class="todo">TODO: report-uri screenshot?</p>
					<p>
						<a href="https://report-uri.com">report-uri.com</a>
					</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Synthetic Testing ğŸ¤–</h3>
					<p class="todo">TODO: synthetic tests with good third-party analysis</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>RUM ğŸ¥ƒ</h3>
					<p>The
						<b>best</b> way to monitor resources,
						<br>even with its limitations</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>ğŸ¥ƒ Waterfalls</h3>
					<video controls="no" autoplay="true" loop="true" height="500px" name="Aggregate Waterfall" src="videos/aggwaterfall.mov"></video>
					<p class="subtitle bottom-left smaller">Akamai mPulse</p>
				</section>
			</section>
			<section data-state="secondary-slide">
				<section data-state="secondary-slide">
					<h4>Stage 4:</h4>
					<h2>Defend ourselves ğŸ¤¼â€â™€ï¸</h2>
				</section>
				<section data-state="tertiary-slide">
					<h3>Content Security Policy ğŸ‘®â€ï¸</h3>
					<img src="images/xss_reporting.png" />https://github.com/nico3333fr/CSP-useful/blob/master/csp-wtf/explained.md
				</section>
				<section data-state="tertiary-slide" data-background-iframe="https://github.com/nico3333fr/CSP-useful/blob/master/csp-wtf/explained.md">
					<h3>Content Security Policy ğŸ‘®â€ï¸</h3>
					<p class="subtitle bottom-left smallest">
						<a href="https://github.com/nico3333fr/CSP-useful/blob/master/csp-wtf/explained.md">github.com/nico3333fr/CSP-useful/blob/master/csp-wtf/explained.md</a>
					</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Content Security Policy ğŸ‘®â€ï¸</h3>
					<div class="center-container-1">
						<div class="center-container-2">
							<div class="centered align-left">
								<p class="fragment">ğŸ‘ CryptoJacking</p>
								<p class="fragment">ğŸ‘ XSS</p>
								<p class="fragment">ğŸ‘ Maintenance</p>
							</div>
						</div>
					</div>
				</section>
				<section data-state="tertiary-slide">
					<h3>Sub-resource Integrity ğŸ”</h3>
					<pre><code class="html" data-trim>
&lt;link
	rel="stylesheet"
	href="//maxcdn.bootstrapcdn.com/.../bootstrap.min.css"
	integrity="
		sha256-8EtRe6XWoFEEhWiaPkLaw...=
		sha512-/5KWJw2mvMO2ZM5fndVxU...=
		"
	
	crossorigin="anonymous"&gt;
					</code></pre>
					<pre><code class="hlhtml" data-trim contenteditable>
&lt;script
	src="//ajax.googleapis.com/.../jquery.min.js"
	integrity="
		sha256-ivk71nXhz9nsyFDoYoGf2...=
		sha512-7aMbXH03HUs6zO1R+pLye...=
		"
		
	crossorigin="anonymous"&gt;&lt;/script&gt;
</script>
</code></pre>
				</section>
				<section data-state="tertiary-slide">
					<h3>Sub-resource Integrity ğŸ”</h3>
					<div class="center-container-1">
						<div class="center-container-2">
							<div class="centered align-left">
								<p class="fragment">ğŸ‘ Malicious Code</p>
								<p class="fragment">ğŸ‘ Untested Changes</p>
								<p class="fragment">ğŸ‘ Maintenance</p>
							</div>
						</div>
					</div>
				</section>
				<section data-state="tertiary-slide">
					<h3>Service Worker ğŸ’ª</h3>
					<pre><code class="hljs compact">
function timeout(delay) {
	return new Promise(function(resolve, reject) {
		setTimeout(function(){
			resolve(new Response('', {
				status: 408,
				statusText: 'Request timed out.'
			}));
		}, delay);
	});
}

self.addEventListener('fetch', function(event) {
	// Only fetch JavaScript files for now
	if (/\.js$/.test(event.request.url)) {
		event.respondWith(Promise.race([timeout(2000), fetch(event.request.url)]));
	} else {
		event.respondWith(fetch(event.request));
	}
});
					</code></pre>
					<p class="subtitle bottom-left smaller">
						<a href="https://calendar.perfplanet.com/2015/reducing-single-point-of-failure-using-service-workers/">calendar.perfplanet.com/2015/reducing-single-point-of-failure-using-service-workers/</a>
					</p>
				</section>
				<section data-state="tertiary-slide">
					<h3>Service Worker ğŸ’ª</h3>
					<div class="center-container-1">
						<div class="center-container-2">
							<div class="centered align-left">
								<p class="fragment">ğŸ‘ CDN / Network outages</p>
								<p class="fragment">ğŸ‘ Maintenance</p>
								<div class="fragment">
									<p>ğŸ‘ You can critically injure your site</p>
									<video src="videos/ko.mp4" autoplay="true" loop="true"></video>
								</div>
							</div>
						</div>
					</div>
				</section>
				<section data-state="tertiary-slide">
					<h3>Self-hosting / Proxying â˜”ï¸</h3>
					<p class="todo">TODO: optimizely self-hosting?</p>
					<p class="todo">TODO: Google fonts self-hosting?</p>
				</section>
				<section data-state="tertiary-slide">
					<div class="center-container-1">
						<div class="center-container-2">
							<div class="centered align-left">
								<p class="fragment">ğŸ‘ CDN / Network outages</p>
								<p class="fragment">ğŸ‘ Shared TCP connection</p>
								<p class="fragment">ğŸ‘ Maintenance</p>
							</div>
						</div>
					</div>
				</section>
			</section>
			<section>
				<section data-state="secondary-slide">
					<h4>Stage 5:</h4>
					<h2>Have a third-party policy ğŸ’¼</h2>
					<ul class="fragment">
						<li>What does it do?</li>
						<li>Who owns it?</li>
						<li>Who uses the data?</li>
						<li>How much is it worth?</li>
						<li>Whatâ€™s the impact on the site?</li>
						<li>How do you remove it?</li>
					</ul>
				</section>
				<section data-state="secondary-slide" data-background-iframe="https://speedcurve.com/demo/thirdparty/?b=chrome&d=30&de=1&ds=1&r=us-west-1&s=299&u=906"
				    data-background-interactive="true">
					<h2 class="light-background">Share with other teams! ğŸ—£</h3>
				</section>
			</section>
			<section data-state="main-slide">
				<section data-state="secondary-slide">
					<h2>Conclusion</h2>
				</section>
				<section data-state="secondary-slide">
					<h3>Third-party content may be a weak link</h3>
					<h2>But it's here to stay</h2>
				</section>
				<section data-state="secondary-slide">
					<h3>Four things you can do today:</h3>
				</section>
				<section data-state="tertiary-slide">
					<h4>Know what's there</h4>
					<ul>
						<li>...</li>
					</ul>
				</section>
				<section data-state="tertiary-slide">
					<h4>Know the impact</h4>
					<ul>
						<li>...</li>
					</ul>
				</section>
				<section data-state="tertiary-slide">
					<h4>Measure them</h4>
					<ul>
						<li>...</li>
					</ul>
				</section>
				<section data-state="tertiary-slide">
					<h4>Have a solid defense</h4>
					<ul>
						<li>...</li>
					</ul>
				</section>
				<section data-state="tertiary-slide">
					<h2>Share data with other teams!</h2>
					<p class="todo">TODO: Dashboard photo?</p>
				</section>
				<section data-state="tertiary-slide">
					<h2>Homework</h2>
					<a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/loading-third-party-javascript/#avoid_scripts_that_pollute_the_global_scope">
						<img src="images/google.png" />
					</a>
				</section>
			</section>
			<section data-state="title-slide">
				<h1>Thank you,
					<br>good luck!</h1>
				<div class="align-container" style="width:75%;margin: 0 auto;">
					<div class="left-align" style="text-align:left;">
						<p>ğŸš´â€â™‚ï¸ @SimonHearne</p>
						<p>ğŸ›  webperf.ninja/tools</p>
						<p>ğŸ–¥ simonhearne.github.io/weak-links</p>
					</div>
				</div>
			</section>
		</div>
		<p class="subtitle top-right">@SimonHearne</p>
	</div>

	<script src="lib/js/head.min.js"></script>
	<script src="js/reveal.js"></script>

	<script>
		Reveal.initialize({
			transition: 'none',
			history: true,
			controlsTutorial: false,
			dependencies: [{
				src: 'plugin/highlight/highlight.js',
				async: true,
				callback: function () {
					hljs.initHighlightingOnLoad();
				}
			}]
		});
	</script>
</body>

</html>